<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Optimizer</title>
    
    <!-- Fonts and CSS Links -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/optimize.css">
</head>
<body>
    <!-- Navigation Bar -->
    <header class="navbar">
        <div class="nav-container">
            <div class="left-section">
                <div class="dots-icon" onclick="toggleSidebar()">
                    <i class="fa-solid fa-bars"></i>
                </div>
                <div class="navbar-brand">
                    <a href="/home" style="text-decoration:none; color:white; font-weight:800;">
                        <h1>NEXUS <span style="font-weight: 700; font-size:0.9rem;">studio</span></h1>
                    </a>
                </div>
            </div>
            <div class="right-section">
                <div class="bell-icon" onclick="toggleNotifications()">
                    <i class="fa-regular fa-bell"></i>
                </div>
                <div class="upgrade">
                    <a href="#" class="nav-link">Upgrade</a>
                </div>
                <div class="user-profile luki">
                    <div class="user-icon" onclick="toggleDropdown()">
                        {{ session['user_initials'] }}
                    </div>
                    <div class="dropdown" id="dropdownMenu">
                        <a href="#" class="dropdown-link">Settings</a>
                        <a href="/logout" class="dropdown-link">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sub Navbar -->
    <nav class="sub-navbar">
        <div class="sub-nav-container">
            <div class="sub-nav-item">
                <p style="color:rgb(46, 96, 224);">Save</p>
                <i class="fas fa-file-alt" style="margin-left:20px; color:gray;"></i>
            </div>
            <div class="sub-nav-item">
                <p>Parameters</p>
                <i class="fas fa-cogs" style="margin-left:20px; color:gray;"></i>
            </div>
        </div>
    </nav>
   
    <!-- Main Content Area -->
    <div class="main-content">
        <div class="content-display">
            <div id="flawsContent">
                <h2 class="toggle-content hoi" onclick="toggleContent('flawsOutput')">
                    What's wrong? <span class="caret"><i class="fa-solid fa-caret-down" style="color: #000000;"></i></span>
                </h2>
                <pre id="flawsOutput" class="hidden-content"></pre>
            </div>

            <div id="optimizedContent">
                <h2 class="toggle-content hoi" onclick="toggleContent('optimizedOutput')">
                    Optimized Content <span class="caret"><i class="fa-solid fa-caret-down" style="color: #000000;"></i></span>
                </h2>
                <pre id="optimizedOutput" class="hidden-content"></pre>
            </div>
        </div>


        <div class="sidebar">
            <h2 style="margin-bottom:20px;">Parameters</h2>
            <label for="fileUpload" style="font-family:'Poppins', sans-serif; font-weight:600; font-size:18px; color:rgb(3, 3, 143);"> Upload:</label>
            <input type="file" id="fileUpload" name="fileUpload" accept=".docx, .txt, .pdf"><br> <br>
            <label for="contentInput" style="font-family:'Poppins', sans-serif; font-weight:600; font-size:18px; color:rgb(3, 3, 143); ">Insert text:</label>
            <textarea id="contentInput" name="contentInput" rows="2" placeholder="Paste your content here..."  style="margin-bottom:20px;"></textarea><br><br>

            
            <form id="optimizerForm" enctype="multipart/form-data" style="display:block;">
                <label for="improvementType" style="font-family: 'Poppins', sans-serif; font-weight:500; margin-bottom:20px;"> Improvement:</label>
                <select id="improvementType" name="improvementType" required>
                    <option value="grammar">Grammar</option>
                    <option value="clarity">Clarity</option>
                    <option value="conciseness">Conciseness</option>
                    <option value="style">Style</option>
                    <option value="all">All</option>
                </select> <br>

                <label for="targetAudience" style="font-family:'Poppins', sans-serif; font-weight:500; margin-bottom:20px;">Target:</label>
                <input type="text" id="targetAudience" name="targetAudience" placeholder="Who is this content for?" required>

                <label for="tone" style="font-family:'Poppins', sans-serif; font-weight:500; margin-bottom:20px;"> Preferred Tone:</label>
                <select id="tone" name="tone" required>
                    <option value="formal">Formal</option>
                    <option value="informal">Informal</option>
                    <option value="professional">Professional</option>
                    <option value="casual">Casual</option>
                </select>

                
                <button type="submit" class=" soli" id="optimizeContentButton">Optimize</button>
                <button type="submit" class=" solix" id="identifyFlawsButton">What's wrong?</button>
               
            </form>
        </div>
    </div>

    <!-- JavaScript to Handle Form Validation and API Request -->
    <script>

        function toggleContent(contentId) {
            var content = document.getElementById(contentId);
            var header = content.previousElementSibling;
        
            if (content.style.display === "block") {
                content.style.display = "none";
                header.querySelector('.caret').classList.remove('active');
            } else {
                content.style.display = "block";
                header.querySelector('.caret').classList.add('active');
            }
        }
        
        document.getElementById('optimizerForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const identifyFlaws = event.submitter.id === 'identifyFlawsButton';

            const formData = new FormData();
            formData.append('improvementType', document.getElementById('improvementType').value);
            formData.append('targetAudience', document.getElementById('targetAudience').value);
            formData.append('tone', document.getElementById('tone').value);

            const contentInput = document.getElementById('contentInput').value.trim();
            const fileInput = document.getElementById('fileUpload').files.length;

            if (!contentInput && !fileInput) {
                alert('Please provide either text input or upload a file.');
                return;
            }

            if (contentInput) {
                formData.append('contentInput', contentInput);
            }

            if (fileInput) {
                formData.append('fileUpload', document.getElementById('fileUpload').files[0]);
            }

            const endpoint = identifyFlaws ? '/identify_flaws' : '/optimize_content';

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                    if (identifyFlaws) {
                        document.getElementById('flawsOutput').textContent = result.flaws;
                        document.getElementById('optimizedOutput').textContent = '';  // Clear optimized content
                    } else {
                        document.getElementById('flawsOutput').textContent = 'No flaws identified.';  // Optional: or use actual flaws if identified
                        document.getElementById('optimizedOutput').textContent = result.optimizedContent;
                    }

                
            } catch (error) {
                console.error('Error processing request:', error);
                alert('There was an issue. Please try again later.');
            }
        });
    </script>
</body>
</html>
